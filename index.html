<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Maurice River at Bivalve – Live Water Levels</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  margin: 24px;
  line-height: 1.35;
}
h1{margin-bottom:4px}
h2{margin-top:28px}
.muted{color:#666;font-size:13px}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:14px;
  margin-top:16px;
}

.card{
  border:1px solid #ddd;
  border-radius:10px;
  padding:14px;
}

.big{
  font-size:28px;
  font-weight:700;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:6px;
}
th,td{
  border-bottom:1px solid #eee;
  padding:6px;
  text-align:left;
}
th{
  font-size:12px;
  color:#666;
  text-transform:uppercase;
}
</style>
</head>

<body>

<h1>Maurice River at Bivalve, NJ</h1>
<div class="muted">
  USGS Station 01412150 · Tidal elevation (NAVD88, feet)
</div>

<div class="grid">
  <div class="card">
    <div class="muted">Live water level</div>
    <div id="live" class="big">—</div>
    <div id="liveMeta" class="muted"></div>
  </div>

  <div class="card">
    <div class="muted">Today's maximum</div>
    <div id="tmax" class="big">—</div>
  </div>

  <div class="card">
    <div class="muted">Today's minimum</div>
    <div id="tmin" class="big">—</div>
  </div>

  <div class="card">
    <div class="muted">Month-to-date maximum</div>
    <div id="mmax" class="big">—</div>
  </div>
</div>

<h2>Top 10 Highest Water Levels</h2>
<table>
<thead>
<tr><th>#</th><th>Date / Time</th><th>Feet (NAVD88)</th></tr>
</thead>
<tbody id="top10"></tbody>
</table>

<h2>Annual Flood Crest Counts</h2>
<table>
<thead>
<tr><th>Year</th><th>Minor</th><th>Moderate</th><th>Major</th></tr>
</thead>
<tbody id="annual"></tbody>
</table>

<script>
const SITE = "01412150";
const TARGET_NAME = "Tidal elevation, NOS-averaged, NAVD88, feet";
const IV_URL =
  `https://waterservices.usgs.gov/nwis/iv/?format=json&sites=${SITE}&period=P30D`;

function fmt(x){ return x.toFixed(2) + " ft"; }
function dt(x){ return new Date(x).toLocaleString(); }

// -----------------------------
// LIVE + DAILY + MONTH STATS
// -----------------------------
fetch(IV_URL)
  .then(r => r.json())
  .then(j => {
    const series = j.value.timeSeries.find(
      s => s.variable.variableName === TARGET_NAME
    );
    if(!series) throw new Error("Target variable not found");

    const data = series.values[0].value
      .map(v => ({ t: v.dateTime, v: +v.value }))
      .filter(d => Number.isFinite(d.v));

    // Live
    const latest = data[data.length - 1];
    document.getElementById("live").textContent = fmt(latest.v);
    document.getElementById("liveMeta").textContent = dt(latest.t);

    // Today
    const today = new Date();
    today.setHours(0,0,0,0);
    const todayData = data.filter(d => new Date(d.t) >= today);
    document.getElementById("tmax").textContent =
      fmt(Math.max(...todayData.map(d => d.v)));
    document.getElementById("tmin").textContent =
      fmt(Math.min(...todayData.map(d => d.v)));

    // Month-to-date
    const month = new Date();
    month.setDate(1);
    month.setHours(0,0,0,0);
    const mtd = data.filter(d => new Date(d.t) >= month);
    document.getElementById("mmax").textContent =
      fmt(Math.max(...mtd.map(d => d.v)));
  })
  .catch(err => {
    console.error(err);
    document.getElementById("live").textContent = "Data error";
  });

// -----------------------------
// STATIC STATS (YOUR DATA)
// -----------------------------
fetch("stats.json", { cache: "no-store" })
  .then(r => r.json())
  .then(s => {

    // Top 10
    s.top10.forEach((x,i) => {
      document.getElementById("top10").innerHTML +=
        `<tr>
           <td>${i+1}</td>
           <td>${dt(x.t)}</td>
           <td>${fmt(x.v)}</td>
         </tr>`;
    });

    // Annual counts
    s.annual
      .sort((a,b) => a.year - b.year)
      .forEach(r => {
        document.getElementById("annual").innerHTML +=
          `<tr>
             <td>${r.year}</td>
             <td>${r.minor}</td>
             <td>${r.moderate}</td>
             <td>${r.major}</td>
           </tr>`;
      });
  })
  .catch(err => {
    console.warn("stats.json not found yet");
  });
</script>

</body>
</html>
